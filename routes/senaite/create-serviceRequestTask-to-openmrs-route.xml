<routes
    xmlns="http://camel.apache.org/schema/spring">
    <route id="create-serviceRequestTask-to-openmrs" errorHandlerRef="watcherErrorHandler">
        <from uri="direct:create-serviceRequestTask-to-openmrs"/>
        
        <log message="Creating FHIR Task for order. " />
        
        <to uri="direct:authenticate-to-openmrs"/>
                                
        <setHeader name="CamelHttpMethod">
            <constant>POST</constant>
        </setHeader>
        
        <setBody>
            <simple>{"resourceType": "Task", "status": "requested", "intent": "order", "basedOn": [{"reference":"${exchangeProperty.lab-order-uuid}", "type": "ServiceRequest"}]}</simple>
        </setBody>
        
        <toD cacheSize="-1" uri="{{fhirR4.baseUrl}}/Task"/>
        <log message="FHIR Task posted results             :          ${body}"/>
    </route>
</routes>
